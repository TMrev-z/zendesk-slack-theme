{{#with user}}
<div class="user-profile-container">
  <nav class="profile-breadcrumbs">
    <ol class="breadcrumbs">
      <li class="breadcrumbs-item">
        <a href="{{help_center.url}}">{{help_center.name}}</a>
      </li>
      {{#if community.url}}
      <li class="breadcrumbs-item">
        <a href="{{community.url}}">ã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£</a>
      </li>
      {{/if}}
    </ol>
  </nav>

  <header class="profile-header">
    <div class="profile-header-main">
      <div class="profile-avatar-section">
        {{#if avatar_url}}
        <img src="{{avatar_url}}" alt="{{name}}" class="profile-avatar" loading="lazy">
        {{else}}
        <div class="profile-avatar-placeholder">
          <span class="avatar-initials">{{initials name}}</span>
        </div>
        {{/if}}
        
        {{#if is_online}}
        <div class="profile-online-indicator">
          <span class="online-dot"></span>
        </div>
        {{/if}}
      </div>

      <div class="profile-info">
        <h1 class="profile-name">{{name}}</h1>
        
        {{#if title}}
        <div class="profile-title">{{title}}</div>
        {{/if}}
        
        {{#if organization}}
        <div class="profile-organization">
          <span class="organization-icon">ğŸ¢</span>
          <span class="organization-name">{{organization.name}}</span>
        </div>
        {{/if}}
        
        <div class="profile-meta">
          {{#if location}}
          <div class="profile-location">
            <span class="location-icon">ğŸ“</span>
            <span class="location-text">{{location}}</span>
          </div>
          {{/if}}
          
          <div class="profile-joined">
            <span class="joined-icon">ğŸ“…</span>
            <span class="joined-text">{{date created_at}}ã«å‚åŠ </span>
          </div>
          
          {{#if last_sign_in_at}}
          <div class="profile-last-seen">
            <span class="last-seen-icon">â°</span>
            <span class="last-seen-text">æœ€çµ‚ãƒ­ã‚°ã‚¤ãƒ³: {{date last_sign_in_at timeago=true}}</span>
          </div>
          {{/if}}
        </div>
        
        {{#if bio}}
        <div class="profile-bio">
          <p>{{bio}}</p>
        </div>
        {{/if}}
      </div>
    </div>

    <div class="profile-actions">
      {{#if current_user}}
        {{#is current_user.id id}}
          <!-- Own profile -->
          <a href="{{edit_profile_url}}" class="btn btn-primary profile-edit">
            ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ã‚’ç·¨é›†
          </a>
        {{else}}
          <!-- Other user's profile -->
          {{#if can_message}}
          <button class="btn btn-primary profile-message" data-user-id="{{id}}">
            ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’é€ã‚‹
          </button>
          {{/if}}
          
          {{#if can_follow}}
          <button class="btn btn-secondary profile-follow {{#if is_following}}profile-follow--active{{/if}}" 
                  data-user-id="{{id}}">
            {{#if is_following}}
              <span class="follow-icon">âœ“</span>
              <span class="follow-text">ãƒ•ã‚©ãƒ­ãƒ¼ä¸­</span>
            {{else}}
              <span class="follow-icon">+</span>
              <span class="follow-text">ãƒ•ã‚©ãƒ­ãƒ¼</span>
            {{/if}}
          </button>
          {{/if}}
        {{/is}}
      {{else}}
        <a href="{{help_center.signin_url}}" class="btn btn-secondary profile-signin">
          ã‚µã‚¤ãƒ³ã‚¤ãƒ³ã—ã¦äº¤æµã™ã‚‹
        </a>
      {{/if}}
    </div>
  </header>

  <main class="profile-main">
    <div class="profile-stats">
      <div class="stats-grid">
        <div class="stat-card">
          <div class="stat-number">{{posts_count}}</div>
          <div class="stat-label">æŠ•ç¨¿</div>
        </div>
        
        <div class="stat-card">
          <div class="stat-number">{{comments_count}}</div>
          <div class="stat-label">ã‚³ãƒ¡ãƒ³ãƒˆ</div>
        </div>
        
        <div class="stat-card">
          <div class="stat-number">{{votes_received}}</div>
          <div class="stat-label">å—ã‘å–ã£ãŸæŠ•ç¥¨</div>
        </div>
        
        <div class="stat-card">
          <div class="stat-number">{{solutions_count}}</div>
          <div class="stat-label">è§£æ±ºã—ãŸè³ªå•</div>
        </div>
        
        <div class="stat-card">
          <div class="stat-number">{{followers_count}}</div>
          <div class="stat-label">ãƒ•ã‚©ãƒ­ãƒ¯ãƒ¼</div>
        </div>
        
        <div class="stat-card">
          <div class="stat-number">{{following_count}}</div>
          <div class="stat-label">ãƒ•ã‚©ãƒ­ãƒ¼ä¸­</div>
        </div>
      </div>
    </div>

    <div class="profile-content">
      <div class="profile-tabs">
        <nav class="tabs-nav">
          <button class="tab-btn tab-btn--active" data-tab="activity">æœ€è¿‘ã®æ´»å‹•</button>
          <button class="tab-btn" data-tab="posts">æŠ•ç¨¿</button>
          <button class="tab-btn" data-tab="comments">ã‚³ãƒ¡ãƒ³ãƒˆ</button>
          <button class="tab-btn" data-tab="solutions">è§£æ±ºç­–</button>
          {{#if badges}}
          <button class="tab-btn" data-tab="badges">ãƒãƒƒã‚¸</button>
          {{/if}}
        </nav>
      </div>

      <!-- Activity Tab -->
      <div class="tab-content tab-content--active" id="activity-tab">
        {{#if recent_activity}}
        <div class="activity-timeline">
          <h3>æœ€è¿‘ã®æ´»å‹•</h3>
          <ul class="timeline-list">
            {{#each recent_activity}}
            <li class="timeline-item">
              <div class="timeline-marker">
                <div class="timeline-icon timeline-icon--{{type}}">
                  {{#is type 'post'}}ğŸ“{{/is}}
                  {{#is type 'comment'}}ğŸ’¬{{/is}}
                  {{#is type 'vote'}}ğŸ‘{{/is}}
                  {{#is type 'solution'}}âœ…{{/is}}
                  {{#is type 'follow'}}ğŸ‘¥{{/is}}
                </div>
              </div>
              
              <div class="timeline-content">
                <div class="timeline-action">
                  {{#is type 'post'}}
                    <a href="{{object.url}}" class="timeline-link">æ–°ã—ã„æŠ•ç¨¿ã‚’ä½œæˆã—ã¾ã—ãŸ</a>
                    <div class="timeline-title">ã€Œ{{object.title}}ã€</div>
                  {{/is}}
                  
                  {{#is type 'comment'}}
                    <a href="{{object.post.url}}#comment-{{object.id}}" class="timeline-link">ã‚³ãƒ¡ãƒ³ãƒˆã—ã¾ã—ãŸ</a>
                    <div class="timeline-title">ã€Œ{{object.post.title}}ã€</div>
                  {{/is}}
                  
                  {{#is type 'vote'}}
                    <span class="timeline-text">æŠ•ç¥¨ã—ã¾ã—ãŸ</span>
                    <div class="timeline-title">ã€Œ{{object.title}}ã€</div>
                  {{/is}}
                  
                  {{#is type 'solution'}}
                    <a href="{{object.url}}" class="timeline-link">å•é¡Œã‚’è§£æ±ºã—ã¾ã—ãŸ</a>
                    <div class="timeline-title">ã€Œ{{object.title}}ã€</div>
                  {{/is}}
                  
                  {{#is type 'follow'}}
                    <span class="timeline-text">{{object.name}}ã•ã‚“ã‚’ãƒ•ã‚©ãƒ­ãƒ¼ã—ã¾ã—ãŸ</span>
                  {{/is}}
                </div>
                
                <time class="timeline-date" datetime="{{created_at}}">
                  {{date created_at timeago=true}}
                </time>
              </div>
            </li>
            {{/each}}
          </ul>
        </div>
        {{else}}
        <div class="activity-empty">
          <div class="empty-state">
            <div class="empty-state-icon">ğŸ“Š</div>
            <h3 class="empty-state-title">ã¾ã æ´»å‹•ãŒã‚ã‚Šã¾ã›ã‚“</h3>
            <p class="empty-state-description">ã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£ã«å‚åŠ ã—ã¦æ´»å‹•ã‚’å§‹ã‚ã¾ã—ã‚‡ã†ã€‚</p>
          </div>
        </div>
        {{/if}}
      </div>

      <!-- Posts Tab -->
      <div class="tab-content" id="posts-tab">
        {{#if posts}}
        <div class="profile-posts">
          <h3>æŠ•ç¨¿ ({{posts.length}})</h3>
          <ul class="posts-list">
            {{#each posts}}
            <li class="post-item">
              <article class="profile-post">
                <h4 class="post-title">
                  <a href="{{url}}" class="post-link">{{title}}</a>
                </h4>
                
                {{#if topic}}
                <div class="post-topic">
                  <a href="{{topic.url}}" class="topic-tag">{{topic.name}}</a>
                </div>
                {{/if}}
                
                <div class="post-stats">
                  <span class="post-votes">{{vote_sum}} æŠ•ç¥¨</span>
                  <span class="post-comments">{{comment_count}} ã‚³ãƒ¡ãƒ³ãƒˆ</span>
                  <time class="post-date" datetime="{{created_at}}">
                    {{date created_at timeago=true}}
                  </time>
                </div>
                
                {{#if status}}
                <div class="post-status post-status--{{status}}">
                  {{#is status 'solved'}}
                    <span class="status-icon">âœ…</span>
                    <span class="status-text">è§£æ±ºæ¸ˆã¿</span>
                  {{/is}}
                  {{#is status 'answered'}}
                    <span class="status-icon">ğŸ’¬</span>
                    <span class="status-text">å›ç­”æ¸ˆã¿</span>
                  {{/is}}
                </div>
                {{/if}}
              </article>
            </li>
            {{/each}}
          </ul>
        </div>
        {{else}}
        <div class="posts-empty">
          <div class="empty-state">
            <div class="empty-state-icon">ğŸ“</div>
            <h3 class="empty-state-title">æŠ•ç¨¿ãŒã‚ã‚Šã¾ã›ã‚“</h3>
            <p class="empty-state-description">ã¾ã æŠ•ç¨¿ã‚’ä½œæˆã—ã¦ã„ã¾ã›ã‚“ã€‚</p>
          </div>
        </div>
        {{/if}}
      </div>

      <!-- Comments Tab -->
      <div class="tab-content" id="comments-tab">
        {{#if comments}}
        <div class="profile-comments">
          <h3>ã‚³ãƒ¡ãƒ³ãƒˆ ({{comments.length}})</h3>
          <ul class="comments-list">
            {{#each comments}}
            <li class="comment-item">
              <article class="profile-comment">
                <div class="comment-content">
                  <div class="comment-body">{{excerpt body characters=200}}</div>
                  <div class="comment-post-info">
                    <span class="comment-label">æŠ•ç¨¿:</span>
                    <a href="{{post.url}}" class="comment-post-link">{{post.title}}</a>
                  </div>
                </div>
                
                <div class="comment-meta">
                  <span class="comment-votes">{{vote_sum}} æŠ•ç¥¨</span>
                  <time class="comment-date" datetime="{{created_at}}">
                    {{date created_at timeago=true}}
                  </time>
                </div>
              </article>
            </li>
            {{/each}}
          </ul>
        </div>
        {{else}}
        <div class="comments-empty">
          <div class="empty-state">
            <div class="empty-state-icon">ğŸ’¬</div>
            <h3 class="empty-state-title">ã‚³ãƒ¡ãƒ³ãƒˆãŒã‚ã‚Šã¾ã›ã‚“</h3>
            <p class="empty-state-description">ã¾ã ã‚³ãƒ¡ãƒ³ãƒˆã‚’æŠ•ç¨¿ã—ã¦ã„ã¾ã›ã‚“ã€‚</p>
          </div>
        </div>
        {{/if}}
      </div>

      <!-- Solutions Tab -->
      <div class="tab-content" id="solutions-tab">
        {{#if solutions}}
        <div class="profile-solutions">
          <h3>è§£æ±ºã—ãŸå•é¡Œ ({{solutions.length}})</h3>
          <ul class="solutions-list">
            {{#each solutions}}
            <li class="solution-item">
              <article class="profile-solution">
                <div class="solution-badge">
                  <span class="solution-icon">âœ…</span>
                </div>
                
                <div class="solution-content">
                  <h4 class="solution-title">
                    <a href="{{post.url}}" class="solution-link">{{post.title}}</a>
                  </h4>
                  
                  <div class="solution-excerpt">{{excerpt solution_text characters=150}}</div>
                  
                  <div class="solution-meta">
                    <time class="solution-date" datetime="{{solved_at}}">
                      {{date solved_at timeago=true}}ã«è§£æ±º
                    </time>
                    {{#if topic}}
                    <a href="{{topic.url}}" class="solution-topic">{{topic.name}}</a>
                    {{/if}}
                  </div>
                </div>
              </article>
            </li>
            {{/each}}
          </ul>
        </div>
        {{else}}
        <div class="solutions-empty">
          <div class="empty-state">
            <div class="empty-state-icon">ğŸ¯</div>
            <h3 class="empty-state-title">è§£æ±ºã—ãŸå•é¡ŒãŒã‚ã‚Šã¾ã›ã‚“</h3>
            <p class="empty-state-description">ã¾ã å•é¡Œã‚’è§£æ±ºã—ã¦ã„ã¾ã›ã‚“ã€‚</p>
          </div>
        </div>
        {{/if}}
      </div>

      <!-- Badges Tab -->
      {{#if badges}}
      <div class="tab-content" id="badges-tab">
        <div class="profile-badges">
          <h3>ç²å¾—ãƒãƒƒã‚¸ ({{badges.length}})</h3>
          <div class="badges-grid">
            {{#each badges}}
            <div class="badge-card">
              <div class="badge-icon-large">{{icon}}</div>
              <div class="badge-info">
                <div class="badge-name">{{name}}</div>
                <div class="badge-description">{{description}}</div>
                {{#if earned_at}}
                <div class="badge-earned">
                  {{date earned_at}}ã«ç²å¾—
                </div>
                {{/if}}
              </div>
            </div>
            {{/each}}
          </div>
        </div>
      </div>
      {{/if}}
    </div>

    <!-- Pagination -->
    {{pagination}}
  </main>

  <aside class="profile-sidebar">
    {{#if contact_info}}
    <div class="profile-contact">
      <h3>é€£çµ¡å…ˆ</h3>
      <div class="contact-info">
        {{#if contact_info.email}}
        <div class="contact-item">
          <span class="contact-icon">ğŸ“§</span>
          <a href="mailto:{{contact_info.email}}" class="contact-link">{{contact_info.email}}</a>
        </div>
        {{/if}}
        
        {{#if contact_info.website}}
        <div class="contact-item">
          <span class="contact-icon">ğŸŒ</span>
          <a href="{{contact_info.website}}" target="_blank" class="contact-link">ã‚¦ã‚§ãƒ–ã‚µã‚¤ãƒˆ</a>
        </div>
        {{/if}}
        
        {{#if contact_info.twitter}}
        <div class="contact-item">
          <span class="contact-icon">ğŸ¦</span>
          <a href="https://twitter.com/{{contact_info.twitter}}" target="_blank" class="contact-link">@{{contact_info.twitter}}</a>
        </div>
        {{/if}}
      </div>
    </div>
    {{/if}}

    {{#if skills}}
    <div class="profile-skills">
      <h3>ã‚¹ã‚­ãƒ«ãƒ»å°‚é–€åˆ†é‡</h3>
      <div class="skills-list">
        {{#each skills}}
        <span class="skill-tag">{{name}}</span>
        {{/each}}
      </div>
    </div>
    {{/if}}

    {{#if following}}
    <div class="profile-following">
      <h3>ãƒ•ã‚©ãƒ­ãƒ¼ä¸­ ({{following.length}})</h3>
      <ul class="following-list">
        {{#each following}}
        <li class="following-item">
          <a href="{{profile_url}}" class="following-link">
            {{#if avatar_url}}
            <img src="{{avatar_url}}" alt="{{name}}" class="following-avatar" loading="lazy">
            {{/if}}
            <span class="following-name">{{name}}</span>
          </a>
        </li>
        {{/each}}
      </ul>
    </div>
    {{/if}}

    <div class="profile-actions-sidebar">
      <a href="{{contributions_url}}" class="btn btn-secondary profile-contributions">
        è²¢çŒ®å±¥æ­´ã‚’è¦‹ã‚‹
      </a>
      
      {{#if current_user}}
        {{#unless is_current_user}}
        <button class="btn btn-secondary profile-report" data-user-id="{{id}}">
          ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’å ±å‘Š
        </button>
        {{/unless}}
      {{/if}}
    </div>
  </aside>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
  // Tab switching
  const tabButtons = document.querySelectorAll('.tab-btn');
  const tabContents = document.querySelectorAll('.tab-content');
  
  tabButtons.forEach(button => {
    button.addEventListener('click', function() {
      const targetTab = this.dataset.tab;
      
      // Remove active class from all tabs and contents
      tabButtons.forEach(btn => btn.classList.remove('tab-btn--active'));
      tabContents.forEach(content => content.classList.remove('tab-content--active'));
      
      // Add active class to clicked tab and corresponding content
      this.classList.add('tab-btn--active');
      document.getElementById(targetTab + '-tab').classList.add('tab-content--active');
    });
  });
  
  // Follow/Unfollow functionality
  const followBtn = document.querySelector('.profile-follow');
  if (followBtn) {
    followBtn.addEventListener('click', function() {
      const userId = this.dataset.userId;
      const isFollowing = this.classList.contains('profile-follow--active');
      
      // Toggle UI immediately
      if (isFollowing) {
        this.classList.remove('profile-follow--active');
        this.querySelector('.follow-icon').textContent = '+';
        this.querySelector('.follow-text').textContent = 'ãƒ•ã‚©ãƒ­ãƒ¼';
      } else {
        this.classList.add('profile-follow--active');
        this.querySelector('.follow-icon').textContent = 'âœ“';
        this.querySelector('.follow-text').textContent = 'ãƒ•ã‚©ãƒ­ãƒ¼ä¸­';
      }
      
      // API call would go here
      console.log(isFollowing ? 'Unfollowing' : 'Following', 'user', userId);
    });
  }
});
</script>
{{/with}}