{{#with post}}
<div class="community-post-container">
  <nav class="post-breadcrumbs">
    <ol class="breadcrumbs">
      <li class="breadcrumbs-item">
        <a href="{{help_center.url}}">{{help_center.name}}</a>
      </li>
      <li class="breadcrumbs-item">
        <a href="{{community.url}}">ã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£</a>
      </li>
      {{#if topic}}
      <li class="breadcrumbs-item">
        <a href="{{topic.url}}">{{topic.name}}</a>
      </li>
      {{/if}}
    </ol>
  </nav>

  <main class="post-main">
    <article class="post-article">
      <header class="post-header">
        <div class="post-status-bar">
          {{#if status}}
          <div class="post-status post-status--{{status}}">
            {{#is status 'solved'}}
              <span class="post-status-icon">âœ…</span>
              <span class="post-status-text">è§£æ±ºæ¸ˆã¿</span>
            {{/is}}
            {{#is status 'answered'}}
              <span class="post-status-icon">ğŸ’¬</span>
              <span class="post-status-text">å›ç­”æ¸ˆã¿</span>
            {{/is}}
            {{#is status 'open'}}
              <span class="post-status-icon">ğŸ”“</span>
              <span class="post-status-text">è­°è«–ä¸­</span>
            {{/is}}
          </div>
          {{/if}}
        </div>

        <h1 class="post-title">{{title}}</h1>
        
        <div class="post-meta-header">
          <div class="post-author-info">
            {{#if author.avatar_url}}
            <img src="{{author.avatar_url}}" alt="{{author.name}}" class="post-author-avatar" loading="lazy">
            {{/if}}
            <div class="post-author-details">
              <span class="post-author-name">{{author.name}}</span>
              <div class="post-dates">
                <time class="post-created" datetime="{{created_at}}">
                  æŠ•ç¨¿æ—¥: {{date created_at}}
                </time>
                {{#if edited_at}}
                <time class="post-edited" datetime="{{edited_at}}">
                  ç·¨é›†: {{date edited_at timeago=true}}
                </time>
                {{/if}}
              </div>
            </div>
          </div>

          <div class="post-actions">
            {{#if current_user}}
            {{#unless closed}}
            <button class="btn btn-secondary post-follow" data-post-id="{{id}}">
              {{#if following}}ãƒ•ã‚©ãƒ­ãƒ¼ä¸­{{else}}ãƒ•ã‚©ãƒ­ãƒ¼ã™ã‚‹{{/if}}
            </button>
            {{/unless}}
            {{#if current_user.agent}}
            <div class="post-admin-actions">
              {{#unless closed}}
              <button class="btn btn-secondary post-close" data-post-id="{{id}}">
                ã‚¯ãƒ­ãƒ¼ã‚º
              </button>
              {{/unless}}
              {{#if pinned}}
              <button class="btn btn-secondary post-unpin" data-post-id="{{id}}">
                ãƒ”ãƒ³è§£é™¤
              </button>
              {{else}}
              <button class="btn btn-secondary post-pin" data-post-id="{{id}}">
                ãƒ”ãƒ³ç•™ã‚
              </button>
              {{/if}}
            </div>
            {{/if}}
            {{/if}}
          </div>
        </div>

        {{#if labels}}
        <div class="post-labels-header">
          {{#each labels}}
          <span class="post-label">{{name}}</span>
          {{/each}}
        </div>
        {{/if}}
      </header>

      <div class="post-content">
        <div class="post-body">{{{details}}}</div>
        
        {{#if attachments}}
        <div class="post-attachments">
          <h4>æ·»ä»˜ãƒ•ã‚¡ã‚¤ãƒ«</h4>
          <ul class="attachment-list">
            {{#each attachments}}
            <li class="attachment-item">
              <a href="{{url}}" class="attachment-link" target="_blank">
                ğŸ“ {{filename}}
                {{#if size}}<span class="attachment-size">({{size}})</span>{{/if}}
              </a>
            </li>
            {{/each}}
          </ul>
        </div>
        {{/if}}
      </div>

      <footer class="post-footer">
        <div class="post-voting">
          {{#if current_user}}
          {{#unless closed}}
          <div class="vote-buttons">
            <button class="vote-btn vote-btn--up {{#if current_vote.up}}vote-btn--active{{/if}}" 
                    data-post-id="{{id}}" data-vote="up">
              <span class="vote-icon">ğŸ‘</span>
              <span class="vote-count">{{vote_up}}</span>
            </button>
            <button class="vote-btn vote-btn--down {{#if current_vote.down}}vote-btn--active{{/if}}" 
                    data-post-id="{{id}}" data-vote="down">
              <span class="vote-icon">ğŸ‘</span>
              <span class="vote-count">{{vote_down}}</span>
            </button>
          </div>
          {{/unless}}
          {{else}}
          <div class="vote-display">
            <div class="vote-score">
              <span class="vote-score-number">{{vote_sum}}</span>
              <span class="vote-score-label">æŠ•ç¥¨</span>
            </div>
          </div>
          {{/if}}
        </div>

        <div class="post-share">
          <span class="share-label">å…±æœ‰:</span>
          <button class="share-btn" onclick="navigator.clipboard.writeText(window.location.href)">
            ğŸ”— ãƒªãƒ³ã‚¯ã‚’ã‚³ãƒ”ãƒ¼
          </button>
        </div>
      </footer>
    </article>

    <!-- Comments Section -->
    <section class="post-comments">
      <header class="comments-header">
        <h3 class="comments-title">
          ã‚³ãƒ¡ãƒ³ãƒˆ
          {{#if comment_count}}
          <span class="comments-count">({{comment_count}})</span>
          {{/if}}
        </h3>
        
        {{#if current_user}}
        {{#unless closed}}
        <div class="comments-sort">
          <select class="comments-sort-select">
            <option value="oldest">å¤ã„é †</option>
            <option value="newest">æ–°ã—ã„é †</option>
            <option value="votes">æŠ•ç¥¨é †</option>
          </select>
        </div>
        {{/unless}}
        {{/if}}
      </header>

      {{#if comments}}
      <ul class="comments-list">
        {{#each comments}}
        <li class="comment-item" id="comment-{{id}}">
          <article class="comment">
            <div class="comment-author-info">
              {{#if author.avatar_url}}
              <img src="{{author.avatar_url}}" alt="{{author.name}}" class="comment-author-avatar" loading="lazy">
              {{/if}}
              <div class="comment-author-details">
                <span class="comment-author-name">{{author.name}}</span>
                <time class="comment-created" datetime="{{created_at}}">
                  {{date created_at timeago=true}}
                </time>
              </div>
            </div>

            <div class="comment-content">
              <div class="comment-body">{{{body}}}</div>
              
              <div class="comment-actions">
                {{#if current_user}}
                {{#unless ../closed}}
                <button class="comment-vote-btn {{#if current_vote.up}}comment-vote-btn--active{{/if}}" 
                        data-comment-id="{{id}}" data-vote="up">
                  ğŸ‘ {{vote_sum}}
                </button>
                <button class="comment-reply-btn" data-comment-id="{{id}}">
                  è¿”ä¿¡
                </button>
                {{#if current_user.agent}}
                <button class="comment-delete-btn" data-comment-id="{{id}}">
                  å‰Šé™¤
                </button>
                {{/if}}
                {{/unless}}
                {{/if}}
              </div>
            </div>
          </article>
        </li>
        {{/each}}
      </ul>
      {{/if}}

      <!-- Comment Form -->
      {{#if current_user}}
      {{#unless closed}}
      <div class="comment-form-wrapper">
        <form class="comment-form" data-post-id="{{id}}">
          <div class="comment-form-header">
            {{#if current_user.avatar_url}}
            <img src="{{current_user.avatar_url}}" alt="{{current_user.name}}" class="comment-form-avatar" loading="lazy">
            {{/if}}
            <span class="comment-form-author">{{current_user.name}}</span>
          </div>
          
          <div class="comment-form-body">
            <textarea class="comment-textarea" name="comment_body" placeholder="ã‚³ãƒ¡ãƒ³ãƒˆã‚’å…¥åŠ›..." required></textarea>
          </div>
          
          <div class="comment-form-actions">
            <button type="submit" class="btn btn-primary comment-submit">
              ã‚³ãƒ¡ãƒ³ãƒˆã™ã‚‹
            </button>
            <button type="button" class="btn btn-secondary comment-cancel" style="display: none;">
              ã‚­ãƒ£ãƒ³ã‚»ãƒ«
            </button>
          </div>
        </form>
      </div>
      {{else}}
      <div class="post-closed-notice">
        <p>ã“ã®æŠ•ç¨¿ã¯ã‚¯ãƒ­ãƒ¼ã‚ºã•ã‚Œã¦ã„ã‚‹ãŸã‚ã€ã‚³ãƒ¡ãƒ³ãƒˆã§ãã¾ã›ã‚“ã€‚</p>
      </div>
      {{/unless}}
      {{else}}
      <div class="comment-signin-prompt">
        <p>ã‚³ãƒ¡ãƒ³ãƒˆã™ã‚‹ã«ã¯<a href="{{help_center.signin_url}}">ã‚µã‚¤ãƒ³ã‚¤ãƒ³</a>ã—ã¦ãã ã•ã„ã€‚</p>
      </div>
      {{/if}}
    </section>
  </main>

  <aside class="post-sidebar">
    {{#if topic}}
    <div class="post-topic-info">
      <h4>ãƒˆãƒ”ãƒƒã‚¯</h4>
      <a href="{{topic.url}}" class="topic-link-sidebar">{{topic.name}}</a>
      {{#if topic.description}}
      <p class="topic-description">{{topic.description}}</p>
      {{/if}}
    </div>
    {{/if}}

    {{#if related_posts}}
    <div class="related-posts">
      <h4>é–¢é€£ã™ã‚‹æŠ•ç¨¿</h4>
      <ul class="related-posts-list">
        {{#each related_posts}}
        <li class="related-post-item">
          <a href="{{url}}" class="related-post-link">{{title}}</a>
          <div class="related-post-meta">
            <span class="related-post-votes">{{vote_sum}} ç¥¨</span>
            <span class="related-post-comments">{{comment_count}} ã‚³ãƒ¡ãƒ³ãƒˆ</span>
          </div>
        </li>
        {{/each}}
      </ul>
    </div>
    {{/if}}

    <div class="post-return">
      <a href="{{community.url}}{{#if topic}}?topic={{topic.id}}{{/if}}" class="btn btn-secondary">
        {{#if topic}}{{topic.name}}ã«æˆ»ã‚‹{{else}}ã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£ã«æˆ»ã‚‹{{/if}}
      </a>
    </div>
  </aside>
</div>
{{/with}}