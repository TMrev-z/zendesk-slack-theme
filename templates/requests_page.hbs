<div class="requests-page-container">
  <nav class="requests-breadcrumbs">
    <ol class="breadcrumbs">
      <li class="breadcrumbs-item">
        <a href="{{help_center.url}}">{{help_center.name}}</a>
      </li>
      <li class="breadcrumbs-item">
        ã‚µãƒãƒ¼ãƒˆãƒªã‚¯ã‚¨ã‚¹ãƒˆ
      </li>
    </ol>
  </nav>

  <header class="requests-header">
    <div class="requests-header-main">
      <h1 class="requests-title">ã‚µãƒãƒ¼ãƒˆãƒªã‚¯ã‚¨ã‚¹ãƒˆ</h1>
      <p class="requests-description">
        ã‚ãªãŸãŒé€ä¿¡ã—ãŸã‚µãƒãƒ¼ãƒˆãƒªã‚¯ã‚¨ã‚¹ãƒˆã®ä¸€è¦§ã§ã™ã€‚å„ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®é€²æ—çŠ¶æ³ã‚’ç¢ºèªã§ãã¾ã™ã€‚
      </p>
    </div>
    
    <div class="requests-actions">
      <a href="{{help_center.url}}/requests/new" class="btn btn-primary requests-new">
        <span class="btn-icon">â•</span>
        <span class="btn-text">æ–°ã—ã„ãƒªã‚¯ã‚¨ã‚¹ãƒˆ</span>
      </a>
    </div>
  </header>

  <main class="requests-main">
    <!-- Filters and Search -->
    <div class="requests-filters">
      <div class="filters-section">
        <div class="filter-group">
          <label for="status-filter" class="filter-label">ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</label>
          <select id="status-filter" class="filter-select">
            <option value="">ã™ã¹ã¦</option>
            <option value="new">æ–°è¦</option>
            <option value="open">å¯¾å¿œä¸­</option>
            <option value="pending">ä¿ç•™ä¸­</option>
            <option value="solved">è§£æ±ºæ¸ˆã¿</option>
            <option value="closed">å®Œäº†</option>
          </select>
        </div>
        
        <div class="filter-group">
          <label for="priority-filter" class="filter-label">å„ªå…ˆåº¦</label>
          <select id="priority-filter" class="filter-select">
            <option value="">ã™ã¹ã¦</option>
            <option value="urgent">ç·Šæ€¥</option>
            <option value="high">é«˜</option>
            <option value="normal">é€šå¸¸</option>
            <option value="low">ä½</option>
          </select>
        </div>
        
        <div class="filter-group">
          <label for="date-filter" class="filter-label">æœŸé–“</label>
          <select id="date-filter" class="filter-select">
            <option value="">ã™ã¹ã¦</option>
            <option value="today">ä»Šæ—¥</option>
            <option value="week">1é€±é–“ä»¥å†…</option>
            <option value="month">1ãƒ¶æœˆä»¥å†…</option>
            <option value="quarter">3ãƒ¶æœˆä»¥å†…</option>
          </select>
        </div>
      </div>
      
      <div class="search-section">
        <div class="search-group">
          <label for="request-search" class="search-label">æ¤œç´¢</label>
          <div class="search-input-wrapper">
            <input type="text" id="request-search" class="search-input" 
                   placeholder="ä»¶åã‚„IDã§æ¤œç´¢...">
            <button type="button" class="search-btn" onclick="searchRequests()">
              <span class="search-icon">ğŸ”</span>
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Requests Statistics -->
    <div class="requests-stats">
      <div class="stats-grid">
        <div class="stat-card stat-card--total">
          <div class="stat-icon">ğŸ“Š</div>
          <div class="stat-content">
            <div class="stat-number">{{requests.total_count}}</div>
            <div class="stat-label">ç·ãƒªã‚¯ã‚¨ã‚¹ãƒˆæ•°</div>
          </div>
        </div>
        
        <div class="stat-card stat-card--open">
          <div class="stat-icon">ğŸ“–</div>
          <div class="stat-content">
            <div class="stat-number">{{requests.open_count}}</div>
            <div class="stat-label">å¯¾å¿œä¸­</div>
          </div>
        </div>
        
        <div class="stat-card stat-card--solved">
          <div class="stat-icon">âœ…</div>
          <div class="stat-content">
            <div class="stat-number">{{requests.solved_count}}</div>
            <div class="stat-label">è§£æ±ºæ¸ˆã¿</div>
          </div>
        </div>
        
        <div class="stat-card stat-card--pending">
          <div class="stat-icon">â³</div>
          <div class="stat-content">
            <div class="stat-number">{{requests.pending_count}}</div>
            <div class="stat-label">ä¿ç•™ä¸­</div>
          </div>
        </div>
      </div>
    </div>

    <!-- Requests List -->
    <div class="requests-content">
      {{#if requests}}
      <div class="requests-list">
        <div class="list-header">
          <div class="list-controls">
            <div class="view-options">
              <button class="view-btn view-btn--active" data-view="card" title="ã‚«ãƒ¼ãƒ‰è¡¨ç¤º">
                <span class="view-icon">â–¦</span>
              </button>
              <button class="view-btn" data-view="table" title="ãƒ†ãƒ¼ãƒ–ãƒ«è¡¨ç¤º">
                <span class="view-icon">â˜°</span>
              </button>
            </div>
            
            <div class="sort-options">
              <label for="sort-select" class="sort-label">ä¸¦ã³é †:</label>
              <select id="sort-select" class="sort-select">
                <option value="updated_desc">æ›´æ–°æ—¥æ™‚ï¼ˆæ–°ã—ã„é †ï¼‰</option>
                <option value="updated_asc">æ›´æ–°æ—¥æ™‚ï¼ˆå¤ã„é †ï¼‰</option>
                <option value="created_desc">ä½œæˆæ—¥æ™‚ï¼ˆæ–°ã—ã„é †ï¼‰</option>
                <option value="created_asc">ä½œæˆæ—¥æ™‚ï¼ˆå¤ã„é †ï¼‰</option>
                <option value="status">ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹é †</option>
                <option value="priority">å„ªå…ˆåº¦é †</option>
              </select>
            </div>
          </div>
        </div>

        <!-- Card View -->
        <div class="requests-grid" id="requests-grid">
          {{#each requests}}
          <article class="request-card" data-status="{{status}}" data-priority="{{priority}}">
            <div class="request-card-header">
              <div class="request-id">
                <span class="id-label">#{{id}}</span>
              </div>
              
              <div class="request-status-badges">
                <span class="status-badge status-badge--{{status}}">
                  <span class="status-icon">
                    {{#is status 'new'}}ğŸ†•{{/is}}
                    {{#is status 'open'}}ğŸ“–{{/is}}
                    {{#is status 'pending'}}â³{{/is}}
                    {{#is status 'solved'}}âœ…{{/is}}
                    {{#is status 'closed'}}ğŸ“{{/is}}
                  </span>
                  <span class="status-text">
                    {{#is status 'new'}}æ–°è¦{{/is}}
                    {{#is status 'open'}}å¯¾å¿œä¸­{{/is}}
                    {{#is status 'pending'}}ä¿ç•™ä¸­{{/is}}
                    {{#is status 'solved'}}è§£æ±ºæ¸ˆã¿{{/is}}
                    {{#is status 'closed'}}å®Œäº†{{/is}}
                  </span>
                </span>
                
                {{#if priority}}
                <span class="priority-badge priority-badge--{{priority}}">
                  <span class="priority-icon">
                    {{#is priority 'urgent'}}ğŸ”´{{/is}}
                    {{#is priority 'high'}}ğŸŸ {{/is}}
                    {{#is priority 'normal'}}ğŸŸ¡{{/is}}
                    {{#is priority 'low'}}ğŸŸ¢{{/is}}
                  </span>
                  <span class="priority-text">
                    {{#is priority 'urgent'}}ç·Šæ€¥{{/is}}
                    {{#is priority 'high'}}é«˜{{/is}}
                    {{#is priority 'normal'}}é€šå¸¸{{/is}}
                    {{#is priority 'low'}}ä½{{/is}}
                  </span>
                </span>
                {{/if}}
              </div>
            </div>

            <div class="request-card-body">
              <h3 class="request-subject">
                <a href="{{url}}" class="subject-link">{{subject}}</a>
              </h3>
              
              {{#if description}}
              <p class="request-excerpt">{{excerpt description characters=120}}</p>
              {{/if}}
            </div>

            <div class="request-card-meta">
              <div class="request-dates">
                <div class="created-date">
                  <span class="date-icon">ğŸ“…</span>
                  <span class="date-text">ä½œæˆ: {{date created_at}}</span>
                </div>
                
                {{#if updated_at}}
                <div class="updated-date">
                  <span class="date-icon">ğŸ”„</span>
                  <span class="date-text">æ›´æ–°: {{date updated_at timeago=true}}</span>
                </div>
                {{/if}}
              </div>
              
              <div class="request-activity">
                {{#if comment_count}}
                <div class="activity-item">
                  <span class="activity-icon">ğŸ’¬</span>
                  <span class="activity-count">{{comment_count}}</span>
                </div>
                {{/if}}
                
                {{#if assignee}}
                <div class="assignee-info">
                  <span class="assignee-label">æ‹…å½“:</span>
                  {{#if assignee.avatar_url}}
                  <img src="{{assignee.avatar_url}}" alt="{{assignee.name}}" class="assignee-avatar" loading="lazy">
                  {{/if}}
                  <span class="assignee-name">{{assignee.name}}</span>
                </div>
                {{/if}}
              </div>
            </div>

            <div class="request-card-actions">
              <a href="{{url}}" class="btn btn-primary btn-small">è©³ç´°ã‚’è¦‹ã‚‹</a>
              
              {{#unless solved}}
              {{#unless closed}}
              <button class="btn btn-secondary btn-small request-update" data-request-id="{{id}}">
                æ›´æ–°ã™ã‚‹
              </button>
              {{/unless}}
              {{/unless}}
            </div>
          </article>
          {{/each}}
        </div>

        <!-- Table View -->
        <div class="requests-table" id="requests-table" style="display: none;">
          <table class="table">
            <thead class="table-header">
              <tr>
                <th class="table-th table-th--id">ID</th>
                <th class="table-th table-th--subject">ä»¶å</th>
                <th class="table-th table-th--status">ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</th>
                <th class="table-th table-th--priority">å„ªå…ˆåº¦</th>
                <th class="table-th table-th--created">ä½œæˆæ—¥</th>
                <th class="table-th table-th--updated">æ›´æ–°æ—¥</th>
                <th class="table-th table-th--assignee">æ‹…å½“è€…</th>
                <th class="table-th table-th--actions">ã‚¢ã‚¯ã‚·ãƒ§ãƒ³</th>
              </tr>
            </thead>
            <tbody class="table-body">
              {{#each requests}}
              <tr class="table-row" data-status="{{status}}" data-priority="{{priority}}">
                <td class="table-td table-td--id">
                  <a href="{{url}}" class="id-link">#{{id}}</a>
                </td>
                <td class="table-td table-td--subject">
                  <a href="{{url}}" class="subject-link">{{subject}}</a>
                </td>
                <td class="table-td table-td--status">
                  <span class="status-badge status-badge--{{status}} status-badge--compact">
                    {{#is status 'new'}}æ–°è¦{{/is}}
                    {{#is status 'open'}}å¯¾å¿œä¸­{{/is}}
                    {{#is status 'pending'}}ä¿ç•™ä¸­{{/is}}
                    {{#is status 'solved'}}è§£æ±ºæ¸ˆã¿{{/is}}
                    {{#is status 'closed'}}å®Œäº†{{/is}}
                  </span>
                </td>
                <td class="table-td table-td--priority">
                  {{#if priority}}
                  <span class="priority-badge priority-badge--{{priority}} priority-badge--compact">
                    {{#is priority 'urgent'}}ç·Šæ€¥{{/is}}
                    {{#is priority 'high'}}é«˜{{/is}}
                    {{#is priority 'normal'}}é€šå¸¸{{/is}}
                    {{#is priority 'low'}}ä½{{/is}}
                  </span>
                  {{else}}
                  <span class="priority-none">-</span>
                  {{/if}}
                </td>
                <td class="table-td table-td--created">
                  <time datetime="{{created_at}}">{{date created_at 'short'}}</time>
                </td>
                <td class="table-td table-td--updated">
                  {{#if updated_at}}
                  <time datetime="{{updated_at}}">{{date updated_at timeago=true}}</time>
                  {{else}}
                  <span class="date-none">-</span>
                  {{/if}}
                </td>
                <td class="table-td table-td--assignee">
                  {{#if assignee}}
                  <div class="assignee-compact">
                    {{#if assignee.avatar_url}}
                    <img src="{{assignee.avatar_url}}" alt="{{assignee.name}}" class="assignee-avatar-small" loading="lazy">
                    {{/if}}
                    <span class="assignee-name-short">{{assignee.name}}</span>
                  </div>
                  {{else}}
                  <span class="assignee-none">æœªå‰²ã‚Šå½“ã¦</span>
                  {{/if}}
                </td>
                <td class="table-td table-td--actions">
                  <div class="table-actions">
                    <a href="{{url}}" class="btn btn-link btn-small">è©³ç´°</a>
                    {{#unless solved}}
                    {{#unless closed}}
                    <button class="btn btn-link btn-small request-update" data-request-id="{{id}}">
                      æ›´æ–°
                    </button>
                    {{/unless}}
                    {{/unless}}
                  </div>
                </td>
              </tr>
              {{/each}}
            </tbody>
          </table>
        </div>
      </div>
      
      <!-- Pagination -->
      {{pagination}}
      
      {{else}}
      <div class="requests-empty">
        <div class="empty-state">
          <div class="empty-state-icon">ğŸ“‹</div>
          <h3 class="empty-state-title">ãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒã‚ã‚Šã¾ã›ã‚“</h3>
          <p class="empty-state-description">
            ã¾ã ã‚µãƒãƒ¼ãƒˆãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡ã—ã¦ã„ã¾ã›ã‚“ã€‚<br>
            ãŠå›°ã‚Šã®ã“ã¨ãŒã”ã–ã„ã¾ã—ãŸã‚‰ã€ãŠæ°—è»½ã«ãŠå•ã„åˆã‚ã›ãã ã•ã„ã€‚
          </p>
          <div class="empty-state-actions">
            <a href="{{help_center.url}}/requests/new" class="btn btn-primary">
              æœ€åˆã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡
            </a>
            <a href="{{help_center.url}}" class="btn btn-secondary">
              ãƒ˜ãƒ«ãƒ—ã‚»ãƒ³ã‚¿ãƒ¼ã‚’è¦‹ã‚‹
            </a>
          </div>
        </div>
      </div>
      {{/if}}
    </div>
  </main>

  <!-- Sidebar -->
  <aside class="requests-sidebar">
    <!-- Quick Actions -->
    <div class="sidebar-section quick-actions">
      <h3 class="sidebar-title">ğŸš€ ã‚¯ã‚¤ãƒƒã‚¯ã‚¢ã‚¯ã‚·ãƒ§ãƒ³</h3>
      <div class="quick-actions-list">
        <a href="{{help_center.url}}/requests/new" class="quick-action">
          <div class="action-icon">â•</div>
          <div class="action-text">æ–°ã—ã„ãƒªã‚¯ã‚¨ã‚¹ãƒˆ</div>
        </a>
        
        {{#if help_center.phone}}
        <a href="tel:{{help_center.phone}}" class="quick-action">
          <div class="action-icon">ğŸ“</div>
          <div class="action-text">é›»è©±ã‚µãƒãƒ¼ãƒˆ</div>
        </a>
        {{/if}}
        
        {{#if community.url}}
        <a href="{{community.url}}" class="quick-action">
          <div class="action-icon">ğŸ’¬</div>
          <div class="action-text">ã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£</div>
        </a>
        {{/if}}
        
        <a href="{{help_center.url}}/hc/{{locale}}/search" class="quick-action">
          <div class="action-icon">ğŸ”</div>
          <div class="action-text">è¨˜äº‹ã‚’æ¤œç´¢</div>
        </a>
      </div>
    </div>

    <!-- Support Information -->
    <div class="sidebar-section support-info">
      <h3 class="sidebar-title">ğŸ“‹ ã‚µãƒãƒ¼ãƒˆæƒ…å ±</h3>
      <div class="support-details">
        <div class="support-item">
          <div class="support-label">å–¶æ¥­æ™‚é–“</div>
          <div class="support-value">å¹³æ—¥ 9:00-18:00</div>
        </div>
        
        <div class="support-item">
          <div class="support-label">å¹³å‡å›ç­”æ™‚é–“</div>
          <div class="support-value">24æ™‚é–“ä»¥å†…</div>
        </div>
        
        <div class="support-item">
          <div class="support-label">è§£æ±ºç‡</div>
          <div class="support-value">95%</div>
        </div>
      </div>
    </div>

    <!-- Tips -->
    <div class="sidebar-section support-tips">
      <h3 class="sidebar-title">ğŸ’¡ ãƒ’ãƒ³ãƒˆ</h3>
      <div class="tips-list">
        <div class="tip-item">
          <div class="tip-icon">ğŸ”„</div>
          <div class="tip-text">ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®æ›´æ–°ã«ã‚ˆã‚Šã€å¯¾å¿œã®å„ªå…ˆåº¦ãŒä¸ŠãŒã‚Šã¾ã™</div>
        </div>
        
        <div class="tip-item">
          <div class="tip-icon">ğŸ“</div>
          <div class="tip-text">ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆã®æ·»ä»˜ã§è§£æ±ºãŒæ—©ã¾ã‚Šã¾ã™</div>
        </div>
        
        <div class="tip-item">
          <div class="tip-icon">ğŸ·ï¸</div>
          <div class="tip-text">é©åˆ‡ãªå„ªå…ˆåº¦ã®è¨­å®šã§åŠ¹ç‡çš„ãªã‚µãƒãƒ¼ãƒˆã‚’</div>
        </div>
      </div>
    </div>

    <!-- Recent Activity -->
    {{#if recent_activity}}
    <div class="sidebar-section recent-activity">
      <h3 class="sidebar-title">ğŸ•’ æœ€è¿‘ã®æ´»å‹•</h3>
      <ul class="activity-list">
        {{#each recent_activity}}
        <li class="activity-item">
          <div class="activity-icon">
            {{#is type 'comment'}}ğŸ’¬{{/is}}
            {{#is type 'status_change'}}ğŸ”„{{/is}}
            {{#is type 'assignment'}}ğŸ‘¤{{/is}}
          </div>
          <div class="activity-content">
            <div class="activity-text">{{description}}</div>
            <div class="activity-time">{{date timestamp timeago=true}}</div>
          </div>
        </li>
        {{/each}}
      </ul>
    </div>
    {{/if}}
  </aside>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
  initializeRequestsPage();
});

function initializeRequestsPage() {
  setupFilters();
  setupSearch();
  setupViewToggle();
  setupSorting();
}

// Filter functionality
function setupFilters() {
  const filters = ['status-filter', 'priority-filter', 'date-filter'];
  
  filters.forEach(filterId => {
    const filter = document.getElementById(filterId);
    if (filter) {
      filter.addEventListener('change', applyFilters);
    }
  });
}

function applyFilters() {
  const statusFilter = document.getElementById('status-filter').value;
  const priorityFilter = document.getElementById('priority-filter').value;
  const dateFilter = document.getElementById('date-filter').value;
  
  const cards = document.querySelectorAll('.request-card, .table-row');
  
  cards.forEach(card => {
    let visible = true;
    
    // Status filter
    if (statusFilter && card.dataset.status !== statusFilter) {
      visible = false;
    }
    
    // Priority filter
    if (priorityFilter && card.dataset.priority !== priorityFilter) {
      visible = false;
    }
    
    // Date filter (simplified - would need actual date comparison)
    // if (dateFilter) {
    //   // Date filtering logic would go here
    // }
    
    card.style.display = visible ? '' : 'none';
  });
}

// Search functionality
function setupSearch() {
  const searchInput = document.getElementById('request-search');
  if (searchInput) {
    searchInput.addEventListener('input', debounce(searchRequests, 300));
    searchInput.addEventListener('keypress', function(e) {
      if (e.key === 'Enter') {
        searchRequests();
      }
    });
  }
}

function searchRequests() {
  const query = document.getElementById('request-search').value.toLowerCase().trim();
  const cards = document.querySelectorAll('.request-card, .table-row');
  
  if (!query) {
    cards.forEach(card => card.style.display = '');
    return;
  }
  
  cards.forEach(card => {
    const subjectElement = card.querySelector('.subject-link');
    const idElement = card.querySelector('.id-link, .id-label');
    
    const subject = subjectElement ? subjectElement.textContent.toLowerCase() : '';
    const id = idElement ? idElement.textContent.toLowerCase() : '';
    
    const matches = subject.includes(query) || id.includes(query);
    card.style.display = matches ? '' : 'none';
  });
}

// View toggle functionality
function setupViewToggle() {
  const viewButtons = document.querySelectorAll('.view-btn');
  const gridView = document.getElementById('requests-grid');
  const tableView = document.getElementById('requests-table');
  
  viewButtons.forEach(button => {
    button.addEventListener('click', function() {
      const view = this.dataset.view;
      
      // Update button states
      viewButtons.forEach(btn => btn.classList.remove('view-btn--active'));
      this.classList.add('view-btn--active');
      
      // Toggle views
      if (view === 'card') {
        gridView.style.display = '';
        tableView.style.display = 'none';
      } else {
        gridView.style.display = 'none';
        tableView.style.display = '';
      }
      
      // Save preference
      localStorage.setItem('requests_view', view);
    });
  });
  
  // Load saved view preference
  const savedView = localStorage.getItem('requests_view');
  if (savedView === 'table') {
    document.querySelector('[data-view="table"]').click();
  }
}

// Sorting functionality
function setupSorting() {
  const sortSelect = document.getElementById('sort-select');
  if (sortSelect) {
    sortSelect.addEventListener('change', sortRequests);
  }
}

function sortRequests() {
  const sortValue = document.getElementById('sort-select').value;
  const container = document.getElementById('requests-grid');
  const cards = Array.from(container.querySelectorAll('.request-card'));
  
  cards.sort((a, b) => {
    switch(sortValue) {
      case 'updated_desc':
        return new Date(b.querySelector('.updated-date .date-text').textContent) - 
               new Date(a.querySelector('.updated-date .date-text').textContent);
      case 'updated_asc':
        return new Date(a.querySelector('.updated-date .date-text').textContent) - 
               new Date(b.querySelector('.updated-date .date-text').textContent);
      case 'created_desc':
        return new Date(b.querySelector('.created-date .date-text').textContent) - 
               new Date(a.querySelector('.created-date .date-text').textContent);
      case 'created_asc':
        return new Date(a.querySelector('.created-date .date-text').textContent) - 
               new Date(b.querySelector('.created-date .date-text').textContent);
      case 'status':
        return a.dataset.status.localeCompare(b.dataset.status);
      case 'priority':
        const priorityOrder = { urgent: 0, high: 1, normal: 2, low: 3 };
        return priorityOrder[a.dataset.priority] - priorityOrder[b.dataset.priority];
      default:
        return 0;
    }
  });
  
  cards.forEach(card => container.appendChild(card));
}

// Utility function for debouncing search
function debounce(func, wait) {
  let timeout;
  return function executedFunction(...args) {
    const later = () => {
      clearTimeout(timeout);
      func(...args);
    };
    clearTimeout(timeout);
    timeout = setTimeout(later, wait);
  };
}

// Request update functionality
document.addEventListener('click', function(e) {
  if (e.target.classList.contains('request-update')) {
    const requestId = e.target.dataset.requestId;
    // This would typically open a modal or navigate to an update page
    window.location.href = `{{help_center.url}}/requests/${requestId}`;
  }
});
</script>