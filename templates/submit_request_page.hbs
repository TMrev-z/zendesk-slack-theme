<div class="submit-request-container">
  <nav class="submit-request-breadcrumbs">
    <ol class="breadcrumbs">
      <li class="breadcrumbs-item">
        <a href="{{help_center.url}}">{{help_center.name}}</a>
      </li>
      <li class="breadcrumbs-item">
        <a href="{{help_center.url}}/requests">ã‚µãƒãƒ¼ãƒˆãƒªã‚¯ã‚¨ã‚¹ãƒˆ</a>
      </li>
      <li class="breadcrumbs-item">
        æ–°ã—ã„ãƒªã‚¯ã‚¨ã‚¹ãƒˆ
      </li>
    </ol>
  </nav>

  <header class="submit-request-header">
    <div class="submit-request-title-section">
      <h1 class="submit-request-title">ã‚µãƒãƒ¼ãƒˆãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡</h1>
      <p class="submit-request-description">
        ãŠå›°ã‚Šã®ã“ã¨ãŒã”ã–ã„ã¾ã—ãŸã‚‰ã€è©³ç´°ã‚’ãŠèã‹ã›ãã ã•ã„ã€‚è¿…é€Ÿã«ã‚µãƒãƒ¼ãƒˆã„ãŸã—ã¾ã™ã€‚
      </p>
    </div>
  </header>

  <main class="submit-request-main">
    <form class="submit-request-form" method="post" action="{{help_center.url}}/requests" enctype="multipart/form-data">
      <div class="form-section form-section--primary">
        <div class="form-group">
          <label for="request-requester-email" class="form-label required">ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹</label>
          <input type="email" id="request-requester-email" name="request[requester][email]" 
                 class="form-input" placeholder="your@email.com" required
                 value="{{current_user.email}}">
          <div class="form-hint">
            è¿”ä¿¡ã‚’ãŠé€ã‚Šã™ã‚‹ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã§ã™
          </div>
        </div>

        <div class="form-group">
          <label for="request-requester-name" class="form-label required">ãŠåå‰</label>
          <input type="text" id="request-requester-name" name="request[requester][name]" 
                 class="form-input" placeholder="å±±ç”° å¤ªéƒ" required
                 value="{{current_user.name}}">
        </div>

        <div class="form-group">
          <label for="request-subject" class="form-label required">ä»¶å</label>
          <input type="text" id="request-subject" name="request[subject]" 
                 class="form-input form-input--large" placeholder="å•é¡Œã®æ¦‚è¦ã‚’ç°¡æ½”ã«è¨˜å…¥ã—ã¦ãã ã•ã„" required>
          <div class="form-hint">
            å•é¡Œã‚’å…·ä½“çš„ã«è¡¨ç¾ã™ã‚‹ä»¶åã‚’å…¥åŠ›ã—ã¦ãã ã•ã„
          </div>
        </div>

        {{#if ticket_forms}}
        <div class="form-group">
          <label for="request-form" class="form-label">ãŠå•ã„åˆã‚ã›ã®ç¨®é¡</label>
          <select id="request-form" name="request[ticket_form_id]" class="form-select">
            <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
            {{#each ticket_forms}}
            <option value="{{id}}">{{name}}</option>
            {{/each}}
          </select>
        </div>
        {{/if}}

        <div class="form-group">
          <label for="request-description" class="form-label required">è©³ç´°èª¬æ˜</label>
          <div class="editor-toolbar">
            <div class="editor-format-buttons">
              <button type="button" class="format-btn" data-format="bold" title="å¤ªå­—">
                <strong>B</strong>
              </button>
              <button type="button" class="format-btn" data-format="italic" title="æ–œä½“">
                <em>I</em>
              </button>
              <button type="button" class="format-btn" data-format="link" title="ãƒªãƒ³ã‚¯">
                ğŸ”—
              </button>
              <button type="button" class="format-btn" data-format="code" title="ã‚³ãƒ¼ãƒ‰">
                &lt;/&gt;
              </button>
              <button type="button" class="format-btn" data-format="list" title="ãƒªã‚¹ãƒˆ">
                â‰¡
              </button>
            </div>
          </div>
          <textarea id="request-description" name="request[comment][body]" 
                    class="form-textarea form-textarea--large" required rows="12"
                    placeholder="å•é¡Œã®è©³ç´°ã€ç™ºç”ŸçŠ¶æ³ã€è©¦ã—ãŸã“ã¨ãªã©ã‚’å…·ä½“çš„ã«è¨˜å…¥ã—ã¦ãã ã•ã„"></textarea>
          <div class="form-hint">
            <strong>åŠ¹æœçš„ãªã‚µãƒãƒ¼ãƒˆã®ãŸã‚ã«ä»¥ä¸‹ã®æƒ…å ±ã‚’å«ã‚ã¦ãã ã•ã„ï¼š</strong>
            <ul class="hint-list">
              <li>å•é¡ŒãŒç™ºç”Ÿã™ã‚‹å…·ä½“çš„ãªæ‰‹é †</li>
              <li>æœŸå¾…ã—ã¦ã„ãŸçµæœã¨å®Ÿéš›ã®çµæœ</li>
              <li>ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ï¼ˆã‚ã‚‹å ´åˆï¼‰</li>
              <li>ä½¿ç”¨ã—ã¦ã„ã‚‹ç’°å¢ƒï¼ˆãƒ–ãƒ©ã‚¦ã‚¶ã€OSç­‰ï¼‰</li>
              <li>å•é¡ŒãŒç™ºç”Ÿã—ãŸæ—¥æ™‚</li>
            </ul>
          </div>
        </div>

        {{#if priority_options}}
        <div class="form-group">
          <label for="request-priority" class="form-label">å„ªå…ˆåº¦</label>
          <div class="priority-options">
            {{#each priority_options}}
            <label class="priority-option">
              <input type="radio" name="request[priority]" value="{{value}}" class="priority-radio"
                     {{#if default}}checked{{/if}}>
              <div class="priority-card priority-card--{{value}}">
                <div class="priority-icon">
                  {{#is value 'urgent'}}ğŸ”´{{/is}}
                  {{#is value 'high'}}ğŸŸ {{/is}}
                  {{#is value 'normal'}}ğŸŸ¡{{/is}}
                  {{#is value 'low'}}ğŸŸ¢{{/is}}
                </div>
                <div class="priority-info">
                  <div class="priority-name">{{name}}</div>
                  <div class="priority-description">
                    {{#is value 'urgent'}}å³åº§ã«å¯¾å¿œãŒå¿…è¦{{/is}}
                    {{#is value 'high'}}24æ™‚é–“ä»¥å†…ã«å¯¾å¿œ{{/is}}
                    {{#is value 'normal'}}é€šå¸¸ã®å¯¾å¿œæ™‚é–“{{/is}}
                    {{#is value 'low'}}æ™‚é–“ã«ä½™è£•ãŒã‚ã‚‹{{/is}}
                  </div>
                </div>
              </div>
            </label>
            {{/each}}
          </div>
        </div>
        {{/if}}
      </div>

      {{#if custom_fields}}
      <div class="form-section form-section--secondary">
        <h3 class="form-section-title">è¿½åŠ æƒ…å ±</h3>
        {{#each custom_fields}}
        <div class="form-group">
          <label for="custom-field-{{id}}" class="form-label {{#if required}}required{{/if}}">
            {{title}}
          </label>
          
          {{#is type 'text'}}
          <input type="text" id="custom-field-{{id}}" name="request[custom_fields][{{id}}]" 
                 class="form-input" {{#if required}}required{{/if}} 
                 placeholder="{{description}}">
          {{/is}}
          
          {{#is type 'textarea'}}
          <textarea id="custom-field-{{id}}" name="request[custom_fields][{{id}}]" 
                    class="form-textarea" rows="4" {{#if required}}required{{/if}}
                    placeholder="{{description}}"></textarea>
          {{/is}}
          
          {{#is type 'dropdown'}}
          <select id="custom-field-{{id}}" name="request[custom_fields][{{id}}]" 
                  class="form-select" {{#if required}}required{{/if}}>
            <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
            {{#each options}}
            <option value="{{value}}">{{name}}</option>
            {{/each}}
          </select>
          {{/is}}
          
          {{#is type 'checkbox'}}
          <div class="checkbox-options">
            {{#each options}}
            <label class="checkbox-option">
              <input type="checkbox" name="request[custom_fields][{{../id}}][]" 
                     value="{{value}}" class="checkbox-input">
              <span class="checkbox-label">{{name}}</span>
            </label>
            {{/each}}
          </div>
          {{/is}}
          
          {{#if description}}
          <div class="field-description">{{description}}</div>
          {{/if}}
        </div>
        {{/each}}
      </div>
      {{/if}}

      <div class="form-section">
        <div class="form-group">
          <label for="request-attachments" class="form-label">æ·»ä»˜ãƒ•ã‚¡ã‚¤ãƒ«</label>
          <div class="file-upload-area">
            <input type="file" id="request-attachments" name="request[comment][attachments][]" 
                   class="file-input" multiple accept="image/*,.pdf,.doc,.docx,.txt,.zip,.log">
            <label for="request-attachments" class="file-upload-label">
              <span class="upload-icon">ğŸ“</span>
              <span class="upload-text">ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠã¾ãŸã¯ãƒ‰ãƒ©ãƒƒã‚°&ãƒ‰ãƒ­ãƒƒãƒ—</span>
            </label>
            <div class="file-list"></div>
          </div>
          <div class="file-upload-hint">
            <strong>æ¨å¥¨ãƒ•ã‚¡ã‚¤ãƒ«:</strong> ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆã€ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«ã€è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«<br>
            <strong>å¯¾å¿œå½¢å¼:</strong> ç”»åƒã€PDFã€Wordæ–‡æ›¸ã€ãƒ†ã‚­ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã€ZIPï¼ˆæœ€å¤§10MBï¼‰
          </div>
        </div>
      </div>

      <div class="form-section">
        <div class="form-group">
          <div class="collaboration-request">
            <label class="collaboration-checkbox">
              <input type="checkbox" name="request[collaborator_ids][]" value="{{current_user.organization.id}}" 
                     class="checkbox-input">
              <span class="checkbox-label">çµ„ç¹”å†…ã®ãƒ¡ãƒ³ãƒãƒ¼ãŒã“ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é–²è¦§ãƒ»ã‚³ãƒ¡ãƒ³ãƒˆã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹</span>
            </label>
          </div>
        </div>
      </div>

      <div class="form-actions">
        <div class="form-actions-main">
          <button type="submit" class="btn btn-primary btn-large">ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡</button>
          <button type="button" class="btn btn-secondary request-preview">ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼</button>
        </div>
        <div class="form-actions-secondary">
          <a href="{{help_center.url}}" class="btn btn-link">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</a>
          <button type="button" class="btn btn-link request-draft" data-action="save-draft">
            ä¸‹æ›¸ãä¿å­˜
          </button>
        </div>
      </div>
    </form>
  </main>

  <aside class="submit-request-sidebar">
    <div class="request-tips">
      <h3>åŠ¹æœçš„ãªãƒªã‚¯ã‚¨ã‚¹ãƒˆã®ã‚³ãƒ„</h3>
      <div class="tips-content">
        <div class="tip-item">
          <div class="tip-icon">ğŸ¯</div>
          <div class="tip-text">
            <strong>å…·ä½“çš„ãªä»¶å</strong><br>
            å•é¡Œã‚’ä¸€ç›®ã§ç†è§£ã§ãã‚‹ä»¶åã‚’ä»˜ã‘ã¦ãã ã•ã„
          </div>
        </div>
        <div class="tip-item">
          <div class="tip-icon">ğŸ“</div>
          <div class="tip-text">
            <strong>è©³ç´°ãªèª¬æ˜</strong><br>
            å•é¡Œã®ç™ºç”Ÿæ‰‹é †ã‚’é †ã‚’è¿½ã£ã¦èª¬æ˜ã—ã¦ãã ã•ã„
          </div>
        </div>
        <div class="tip-item">
          <div class="tip-icon">ğŸ“·</div>
          <div class="tip-text">
            <strong>ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆ</strong><br>
            ã‚¨ãƒ©ãƒ¼ç”»é¢ã‚„å•é¡Œç®‡æ‰€ã®ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆã‚’æ·»ä»˜ã—ã¦ãã ã•ã„
          </div>
        </div>
        <div class="tip-item">
          <div class="tip-icon">ğŸ”</div>
          <div class="tip-text">
            <strong>æ¤œç´¢ã—ã¦ã‹ã‚‰é€ä¿¡</strong><br>
            é¡ä¼¼ã®å•é¡ŒãŒãªã„ã‹ãƒ˜ãƒ«ãƒ—ã‚»ãƒ³ã‚¿ãƒ¼ã§æ¤œç´¢ã—ã¦ã¿ã¦ãã ã•ã„
          </div>
        </div>
      </div>
    </div>

    <div class="support-info">
      <h3>ã‚µãƒãƒ¼ãƒˆå¯¾å¿œæ™‚é–“</h3>
      <div class="support-schedule">
        <div class="schedule-item">
          <div class="schedule-day">å¹³æ—¥</div>
          <div class="schedule-time">9:00 - 18:00</div>
        </div>
        <div class="schedule-item">
          <div class="schedule-day">åœŸæ—¥ãƒ»ç¥æ—¥</div>
          <div class="schedule-time">å¯¾å¿œãªã—</div>
        </div>
      </div>
      <div class="response-time">
        <h4>ç›®å®‰å›ç­”æ™‚é–“</h4>
        <ul class="response-list">
          <li><span class="priority-urgent">ç·Šæ€¥:</span> 2æ™‚é–“ä»¥å†…</li>
          <li><span class="priority-high">é«˜:</span> 24æ™‚é–“ä»¥å†…</li>
          <li><span class="priority-normal">é€šå¸¸:</span> 2-3å–¶æ¥­æ—¥</li>
          <li><span class="priority-low">ä½:</span> 1é€±é–“ä»¥å†…</li>
        </ul>
      </div>
    </div>

    <div class="alternative-support">
      <h3>ãã®ä»–ã®ã‚µãƒãƒ¼ãƒˆæ–¹æ³•</h3>
      <div class="support-options">
        {{#if help_center.phone}}
        <div class="support-option">
          <div class="support-icon">ğŸ“</div>
          <div class="support-info">
            <div class="support-method">é›»è©±ã‚µãƒãƒ¼ãƒˆ</div>
            <div class="support-value">{{help_center.phone}}</div>
            <div class="support-hours">å¹³æ—¥ 9:00-17:00</div>
          </div>
        </div>
        {{/if}}

        {{#if community.url}}
        <div class="support-option">
          <div class="support-icon">ğŸ’¬</div>
          <div class="support-info">
            <div class="support-method">ã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£</div>
            <a href="{{community.url}}" class="support-link">è³ªå•ã‚’æŠ•ç¨¿</a>
            <div class="support-description">ä»–ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¨æƒ…å ±äº¤æ›</div>
          </div>
        </div>
        {{/if}}

        {{#if help_center.chat_enabled}}
        <div class="support-option">
          <div class="support-icon">ğŸ’­</div>
          <div class="support-info">
            <div class="support-method">ãƒãƒ£ãƒƒãƒˆã‚µãƒãƒ¼ãƒˆ</div>
            <button class="support-link" onclick="startChat()">ãƒãƒ£ãƒƒãƒˆã‚’é–‹å§‹</button>
            <div class="support-description">ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã‚µãƒãƒ¼ãƒˆ</div>
          </div>
        </div>
        {{/if}}
      </div>
    </div>

    <div class="quick-solutions">
      <h3>ã‚ˆãã‚ã‚‹è§£æ±ºç­–</h3>
      <ul class="quick-solutions-list">
        <li><a href="{{help_center.url}}/articles/password-reset">ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒªã‚»ãƒƒãƒˆ</a></li>
        <li><a href="{{help_center.url}}/articles/account-setup">ã‚¢ã‚«ã‚¦ãƒ³ãƒˆè¨­å®š</a></li>
        <li><a href="{{help_center.url}}/articles/billing-issues">è«‹æ±‚ã«é–¢ã™ã‚‹å•é¡Œ</a></li>
        <li><a href="{{help_center.url}}/articles/technical-issues">æŠ€è¡“çš„ãªå•é¡Œ</a></li>
      </ul>
    </div>
  </aside>
</div>

<!-- Preview Modal -->
<div class="preview-modal" id="preview-modal" style="display: none;">
  <div class="preview-modal-overlay" onclick="closePreview()"></div>
  <div class="preview-modal-content">
    <div class="preview-modal-header">
      <h3 class="preview-modal-title">ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼</h3>
      <button class="preview-modal-close" onclick="closePreview()">Ã—</button>
    </div>
    <div class="preview-modal-body">
      <div class="preview-content" id="preview-content"></div>
    </div>
    <div class="preview-modal-footer">
      <button class="btn btn-primary" onclick="closePreview()">ç·¨é›†ã«æˆ»ã‚‹</button>
    </div>
  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
  // File upload handling
  const fileInput = document.getElementById('request-attachments');
  const uploadArea = fileInput.closest('.file-upload-area');
  const fileList = uploadArea.querySelector('.file-list');
  
  fileInput.addEventListener('change', function() {
    displayFiles(this.files, fileList);
  });
  
  // Drag and drop
  uploadArea.addEventListener('dragover', function(e) {
    e.preventDefault();
    this.classList.add('drag-over');
  });
  
  uploadArea.addEventListener('dragleave', function(e) {
    e.preventDefault();
    this.classList.remove('drag-over');
  });
  
  uploadArea.addEventListener('drop', function(e) {
    e.preventDefault();
    this.classList.remove('drag-over');
    
    const files = e.dataTransfer.files;
    fileInput.files = files;
    displayFiles(files, fileList);
  });
  
  function displayFiles(files, container) {
    container.innerHTML = '';
    
    Array.from(files).forEach((file, index) => {
      const fileItem = document.createElement('div');
      fileItem.className = 'file-item';
      fileItem.innerHTML = `
        <span class="file-name">${file.name}</span>
        <span class="file-size">(${formatFileSize(file.size)})</span>
        <button type="button" class="file-remove" data-index="${index}">Ã—</button>
      `;
      
      container.appendChild(fileItem);
    });
  }
  
  function formatFileSize(bytes) {
    if (bytes === 0) return '0 Bytes';
    const k = 1024;
    const sizes = ['Bytes', 'KB', 'MB', 'GB'];
    const i = Math.floor(Math.log(bytes) / Math.log(k));
    return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
  }
  
  // Format buttons
  const formatButtons = document.querySelectorAll('.format-btn');
  const textarea = document.getElementById('request-description');
  
  formatButtons.forEach(button => {
    button.addEventListener('click', function(e) {
      e.preventDefault();
      const format = this.dataset.format;
      insertFormat(format, textarea);
    });
  });
  
  function insertFormat(format, textarea) {
    const start = textarea.selectionStart;
    const end = textarea.selectionEnd;
    const selectedText = textarea.value.substring(start, end);
    let replacement = '';
    
    switch(format) {
      case 'bold':
        replacement = `**${selectedText || 'ãƒ†ã‚­ã‚¹ãƒˆ'}**`;
        break;
      case 'italic':
        replacement = `*${selectedText || 'ãƒ†ã‚­ã‚¹ãƒˆ'}*`;
        break;
      case 'link':
        replacement = `[${selectedText || 'ãƒªãƒ³ã‚¯ãƒ†ã‚­ã‚¹ãƒˆ'}](URL)`;
        break;
      case 'code':
        replacement = `\`${selectedText || 'ã‚³ãƒ¼ãƒ‰'}\``;
        break;
      case 'list':
        replacement = `- ${selectedText || 'ãƒªã‚¹ãƒˆé …ç›®'}`;
        break;
    }
    
    textarea.value = textarea.value.substring(0, start) + replacement + textarea.value.substring(end);
    textarea.focus();
  }
  
  // Preview functionality
  const previewBtn = document.querySelector('.request-preview');
  if (previewBtn) {
    previewBtn.addEventListener('click', function(e) {
      e.preventDefault();
      showPreview();
    });
  }
  
  function showPreview() {
    const email = document.getElementById('request-requester-email').value;
    const name = document.getElementById('request-requester-name').value;
    const subject = document.getElementById('request-subject').value;
    const description = document.getElementById('request-description').value;
    const priority = document.querySelector('input[name="request[priority]"]:checked')?.nextElementSibling?.querySelector('.priority-name')?.textContent || '';
    
    const previewContent = document.getElementById('preview-content');
    previewContent.innerHTML = `
      <div class="preview-request">
        <div class="preview-header">
          <div class="preview-meta">
            <div class="preview-sender">å·®å‡ºäºº: ${name || 'åå‰ãªã—'} &lt;${email || 'ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ãªã—'}&gt;</div>
            ${priority ? `<div class="preview-priority">å„ªå…ˆåº¦: ${priority}</div>` : ''}
          </div>
          <h2 class="preview-subject">${subject || 'ä»¶åãªã—'}</h2>
        </div>
        <div class="preview-body">${markdownToHtml(description) || 'ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ãªã—'}</div>
      </div>
    `;
    
    document.getElementById('preview-modal').style.display = 'block';
  }
  
  function markdownToHtml(markdown) {
    return markdown
      .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
      .replace(/\*(.*?)\*/g, '<em>$1</em>')
      .replace(/`(.*?)`/g, '<code>$1</code>')
      .replace(/^- (.+)$/gm, '<li>$1</li>')
      .replace(/\n/g, '<br>');
  }
  
  window.closePreview = function() {
    document.getElementById('preview-modal').style.display = 'none';
  };
  
  // Draft functionality
  const draftBtn = document.querySelector('.request-draft');
  if (draftBtn) {
    draftBtn.addEventListener('click', function() {
      saveDraft();
    });
  }
  
  function saveDraft() {
    const draftData = {
      email: document.getElementById('request-requester-email').value,
      name: document.getElementById('request-requester-name').value,
      subject: document.getElementById('request-subject').value,
      description: document.getElementById('request-description').value,
      priority: document.querySelector('input[name="request[priority]"]:checked')?.value,
      timestamp: new Date().toISOString()
    };
    
    localStorage.setItem('support_request_draft', JSON.stringify(draftData));
    
    // Show feedback
    draftBtn.textContent = 'ä¿å­˜ã—ã¾ã—ãŸ';
    draftBtn.disabled = true;
    setTimeout(() => {
      draftBtn.textContent = 'ä¸‹æ›¸ãä¿å­˜';
      draftBtn.disabled = false;
    }, 2000);
  }
  
  // Load draft on page load
  const savedDraft = localStorage.getItem('support_request_draft');
  if (savedDraft) {
    const draftData = JSON.parse(savedDraft);
    if (confirm('ä¿å­˜ã•ã‚ŒãŸä¸‹æ›¸ããŒã‚ã‚Šã¾ã™ã€‚èª­ã¿è¾¼ã¿ã¾ã™ã‹ï¼Ÿ')) {
      document.getElementById('request-requester-email').value = draftData.email || '';
      document.getElementById('request-requester-name').value = draftData.name || '';
      document.getElementById('request-subject').value = draftData.subject || '';
      document.getElementById('request-description').value = draftData.description || '';
      if (draftData.priority) {
        const priorityRadio = document.querySelector(`input[name="request[priority]"][value="${draftData.priority}"]`);
        if (priorityRadio) priorityRadio.checked = true;
      }
    }
  }
  
  // Form validation
  const form = document.querySelector('.submit-request-form');
  form.addEventListener('submit', function(e) {
    const requiredFields = form.querySelectorAll('[required]');
    let isValid = true;
    
    requiredFields.forEach(field => {
      if (!field.value.trim()) {
        isValid = false;
        field.classList.add('error');
      } else {
        field.classList.remove('error');
      }
    });
    
    if (!isValid) {
      e.preventDefault();
      alert('å¿…é ˆé …ç›®ã‚’ã™ã¹ã¦å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚');
      return;
    }
    
    // Clear draft on successful submission
    localStorage.removeItem('support_request_draft');
  });
  
  // Auto-save draft every 60 seconds
  setInterval(function() {
    const subject = document.getElementById('request-subject').value.trim();
    const description = document.getElementById('request-description').value.trim();
    
    if (subject || description) {
      saveDraft();
    }
  }, 60000);
  
  // Chat functionality (if available)
  window.startChat = function() {
    // Integration with chat widget would go here
    if (window.zE) {
      window.zE('webWidget', 'open');
    } else {
      alert('ãƒãƒ£ãƒƒãƒˆæ©Ÿèƒ½ã¯ç¾åœ¨åˆ©ç”¨ã§ãã¾ã›ã‚“ã€‚');
    }
  };
});
</script>